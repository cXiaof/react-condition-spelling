"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var React=require("react"),React__default=_interopDefault(React),uuid=_interopDefault(require("uuid"));function styleInject(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===n&&o.firstChild?o.insertBefore(r,o.firstChild):o.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}}var css="@import url(c:\\Users\\DELL\\Documents\\www\\react-condition-spelling\\src\\stylesheets\\iconfont\\iconfont.css);.react-condition-spelling .rcs-box>*{box-sizing:border-box;height:calc(1.2rem + 4px);padding:0 .5rem;vertical-align:middle}.react-condition-spelling .rcs-box .rcs-box-door,.react-condition-spelling .rcs-box .rcs-box-parenthese{width:10%}.react-condition-spelling .rcs-box .rcs-box-field,.react-condition-spelling .rcs-box .rcs-box-symbol{width:20%}.react-condition-spelling .rcs-box .rcs-box-value{width:25%}.react-condition-spelling .rcs-box .rcs-box-buttons{width:5%;display:-webkit-inline-flex;display:inline-flex;-webkit-align-items:center;align-items:center;-webkit-justify-content:space-around;justify-content:space-around}.react-condition-spelling .rcs-box .rcs-box-buttons i{font-size:1rem;margin:0 2px}.react-condition-spelling .rcs-box div.rcs-box-door{display:inline-block;overflow:hidden;text-overflow:ellipsis;padding:0}";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(e){_defineProperty(t,e,n[e])})}return t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _iterableToArrayLimit(e,t){var n=[],o=!0,r=!1,a=void 0;try{for(var i,l=e[Symbol.iterator]();!(o=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);o=!0);}catch(e){r=!0,a=e}finally{try{o||null==l.return||l.return()}finally{if(r)throw a}}return n}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}styleInject(css);var configDefault={symbols:{text:{"=":{symbol:"="},"≠":{symbol:"<>"},like:{symbol:"LIKE",preprocess:function(e){return"%".concat(e,"%")}},"start with":{symbol:"LIKE",preprocess:function(e){return"".concat(e,"%")}},"end with":{symbol:"LIKE",preprocess:function(e){return"%".concat(e)}},"is null":{symbol:"IS NULL",noNeedValue:!0},"is not null":{symbol:"IS NOT NULL",noNeedValue:!0}},number:{"=":{symbol:"="},"≠":{symbol:"<>"},"<":{symbol:"<"},"<=":{symbol:"<="},">":{symbol:">"},">=":{symbol:">="}}},doors:{and:"AND",or:"OR"},title:"condition: ",error:"No fields!",placeholderLeft:'" ( " only',placeholderRight:'" ) " only',placeholderInput:"input here"},ConditionSpellingBoxField=function(e){var t=e.className,n=e.fields,o=e.onChange;return React__default.createElement("select",{className:t,onChange:o},Object.entries(n).map(function(e){var t=_slicedToArray(e,2),n=t[0],o=t[1].name;return React__default.createElement("option",{key:n,value:n},o)}))},ConditionSpellingBoxDoor=function(e){var t=e.className,n=e.title,o=e.doors,r=e.onChange;return n?React__default.createElement("div",{className:t},n):React__default.createElement("select",{className:t,onChange:r},Object.entries(o).map(function(e){var t=_slicedToArray(e,1)[0];return React__default.createElement("option",{key:t,value:t},t)}))},ConditionSpellingBoxSymbol=function(){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,React.Component),_createClass(e,[{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.type,o=t.symbols,r=t.onChange;n!==e.type&&r({target:{value:Object.keys(o[n])[0]}})}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.type,o=e.symbols,r=e.onChange;return React__default.createElement("select",{className:t,onChange:r},Object.entries(o[n]).map(function(e){var t=_slicedToArray(e,1)[0];return React__default.createElement("option",{key:t,value:t},t)}))}}]),e}(),ConditionSpellingBoxParenthese=function(){function n(e){var t;return _classCallCheck(this,n),(t=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,e))).state={value:""},t}return _inherits(n,React.Component),_createClass(n,[{key:"handleChange",value:function(e){var t=this.props,n=t.left,o=t.right;""===e.target.value&&this.updateValueFireChange("");var r=[],a=e.target.value.match(/\(/g),i=e.target.value.match(/\)/g);n&&a&&(r=[].concat(_toConsumableArray(r),_toConsumableArray(a))),o&&i&&(r=[].concat(_toConsumableArray(r),_toConsumableArray(i))),0<r.length&&this.updateValueFireChange(r.join(""))}},{key:"updateValueFireChange",value:function(e){var t=this.props.onChange;this.setState(_objectSpread({},this.state,{value:e})),t({target:{value:e}})}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.placeholder,o=this.state.value;return React__default.createElement("input",{value:o,className:t,placeholder:n,onChange:this.handleChange.bind(this)})}}]),n}(),ConditionSpellingBox=function(){function u(e){var t;_classCallCheck(this,u),t=_possibleConstructorReturn(this,_getPrototypeOf(u).call(this,e));var n=e.fields,o=e.symbols,r=e.doors,a=_slicedToArray(Object.entries(n)[0],2),i=a[0],l=a[1].type,s=_slicedToArray(Object.entries(o[l])[0],2),c={field:i,type:l,symbol:s[0],noNeedValue:s[1].noNeedValue};return c.door=Object.keys(r)[0],t.state=c,t}return _inherits(u,React.Component),_createClass(u,[{key:"componentDidUpdate",value:function(){var e,t=this.props,n=t.onChange,o=t.doors,r=t.first,a=this.state,i=a.field,l=a.door,s=a.left,c=a.right,u=this.getConditionSymbolValue();if(u){var d=u.symbol,h=u.value;h=h||"",c=c||"",e=" ".concat(s=s||"").concat(i," ").concat(d).concat(h).concat(c),!r&&l&&(e=" ".concat(o[l]).concat(e))}this.lastCondition!==e&&n(this.lastCondition=e,_objectSpread({},this.state))}},{key:"getConditionSymbolValue",value:function(){var e=this.state,t=e.symbol,n=e.value,o=e.type,r=this.props.symbols[o][t];if(r){var a=r.preprocess;if(r.noNeedValue)return{symbol:r.symbol};var i=a?a(n):n;if(void 0!==n)return{value:i="text"===o?" '".concat(i,"'"):" ".concat(i),symbol:r.symbol}}}},{key:"setStateWithEvent",value:function(e,t){this.setState(_objectSpread({},this.state,_defineProperty({},e,t.target.value)))}},{key:"getRcsBoxDoor",value:function(){var e=this.props,t=e.first,n=e.doors,o=e.title;return React__default.createElement(ConditionSpellingBoxDoor,{className:"rcs-box-door",title:t?o:null,doors:n,onChange:this.setStateWithEvent.bind(this,"door")})}},{key:"getRcsBoxParentheseLeft",value:function(){var e=this.props.placeholderLeft;return React__default.createElement(ConditionSpellingBoxParenthese,{left:!0,placeholder:e,className:"rcs-box-parenthese rcs-box-left",onChange:this.setStateWithEvent.bind(this,"left")})}},{key:"getRcsBoxField",value:function(){var e=this.props.fields;return React__default.createElement(ConditionSpellingBoxField,{className:"rcs-box-field",fields:e,onChange:this.handleChangeField.bind(this)})}},{key:"handleChangeField",value:function(e){var t=this.props.fields,n=this.state.value,o=e.target.value,r=t[o].type||"text",a=_objectSpread({},this.state,{field:o,type:r});"number"===r&&n!==parseFloat(n).toString()&&(a.value=void 0);this.setState(a)}},{key:"getRcsBoxSymbol",value:function(){var e=this.props.symbols,t=this.state.type;return React__default.createElement(ConditionSpellingBoxSymbol,{className:"rcs-box-symbol",type:t,symbols:e,onChange:this.handleChangeSymbol.bind(this)})}},{key:"handleChangeSymbol",value:function(e){var t=this.props.symbols,n=this.state.type,o=e.target.value,r=t[n][o].noNeedValue;this.setState(_objectSpread({},this.state,{symbol:o,noNeedValue:r}))}},{key:"getRcsBoxValue",value:function(){var e=this.state,t=e.type,n=e.noNeedValue,o=this.props.placeholderInput;return React__default.createElement("input",{className:"rcs-box-value",disabled:n,type:t,placeholder:o,onChange:this.setStateWithEvent.bind(this,"value")})}},{key:"getRcsBoxParentheseRight",value:function(){var e=this.props.placeholderRight;return React__default.createElement(ConditionSpellingBoxParenthese,{right:!0,placeholder:e,className:"rcs-box-parenthese rcs-box-right",onChange:this.setStateWithEvent.bind(this,"right")})}},{key:"getRcsBoxButtons",value:function(){var e=this.props,t=e.onAdd,n=e.onDelete,o=e.noInsert;return React__default.createElement("div",{className:"rcs-box-buttons"},React__default.createElement("i",{className:"iconfont icon-delete",onClick:n}),o?null:React__default.createElement("i",{className:"iconfont icon-insert",onClick:t}))}},{key:"render",value:function(){var e=this.props.id;return React__default.createElement("div",{id:e,className:"rcs-box"},this.getRcsBoxDoor(),this.getRcsBoxParentheseLeft(),this.getRcsBoxField(),this.getRcsBoxSymbol(),this.getRcsBoxValue(),this.getRcsBoxParentheseRight(),this.getRcsBoxButtons())}}]),u}(),ConditionSpelling=function(){function s(e){var t;_classCallCheck(this,s),(t=_possibleConstructorReturn(this,_getPrototypeOf(s).call(this,e))).alwaysTrue=" 1 = 1";var n=Math.max(~~e.max,0)||1/0,o=e.showAll&&void 0!==e.max&&n!==1/0,r=t.getConfig(e.config||{}),a=e.fields||{},i=t.alwaysTrue,l=t.getInitValue(n,o);return t.state={max:n,showAll:o,config:r,fields:a,result:i,value:l},t}return _inherits(s,React.Component),_createClass(s,[{key:"getInitValue",value:function(e,t){if(!t)return[this.getOneItemWithUid()];for(var n=[],o=0;o<e;o++)n.push(this.getOneItemWithUid());return n}},{key:"getConfig",value:function(e){return{symbols:e.symbols||configDefault.symbols,doors:e.doors||configDefault.doors,title:void 0!==e.title?e.title:configDefault.title,error:void 0!==e.error?e.error:configDefault.error,placeholderLeft:void 0!==e.placeholderLeft?e.placeholderLeft:configDefault.placeholderLeft,placeholderRight:void 0!==e.placeholderRight?e.placeholderRight:configDefault.placeholderRight,placeholderInput:void 0!==e.placeholderInput?e.placeholderInput:configDefault.placeholderInput}}},{key:"componentDidUpdate",value:function(e,t){var n=this.props.onChange,o=this.state,r=o.result,a=o.value;r!==t.result&&n(r||this.alwaysTrue,a)}},{key:"getOneItemWithUid",value:function(){return{id:uuid.v1().toString()}}},{key:"getResult",value:function(e){return e.reduce(function(e,t){var n=t.condition;return"".concat(e).concat(n||"")},"")}},{key:"handleBoxChange",value:function(e,t,n){var o=_toConsumableArray(this.state.value);o[e]=_objectSpread({},o[e],{condition:t,data:n,illegal:void 0===t});var r=this.getResult(o);this.setState(_objectSpread({},this.state,{value:o,result:r}))}},{key:"handleInsert",value:function(e){var t=this.state,n=t.value,o=t.max;n.length!==o&&(n.splice(e+1,0,this.getOneItemWithUid()),this.setState(_objectSpread({},this.state,{value:n})))}},{key:"handleDelete",value:function(e){var t=this.state,n=t.max,o=t.showAll,r=_toConsumableArray(this.state.value);if(r.splice(e,1),0===r.length&&(r=[this.getOneItemWithUid()]),o)for(var a=0;a<n-r.length;a++)r.push(this.getOneItemWithUid());var i=this.getResult(r);this.setState(_objectSpread({},this.state,{value:r,result:i}))}},{key:"getRcsBoxes",value:function(){var o=this,e=this.state,r=e.showAll,a=e.max,i=e.config,l=e.fields,s=e.value;return s.map(function(e,t){var n=e.id;return React__default.createElement(ConditionSpellingBox,_extends({key:n,id:n,first:0===t,noInsert:r||a===s.length,fields:l,onChange:o.handleBoxChange.bind(o,t),onAdd:o.handleInsert.bind(o,t),onDelete:o.handleDelete.bind(o,t)},i))})}},{key:"getRcsBody",value:function(){var e=this.state,t=e.fields,n=e.config;return 0===Object.keys(t).length?n.error:this.getRcsBoxes()}},{key:"render",value:function(){return React__default.createElement("div",{className:"react-condition-spelling"},this.getRcsBody())}}]),s}();module.exports=ConditionSpelling;
